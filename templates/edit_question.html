{% extends "base.html" %}

{% block title %}Edit Question{% endblock %}

{% block content %}
<h2>Edit Question</h2>

<form method="post">

  <!-- Question Text -->
  <div class="form-group">
    <label for="question_text">Question</label>
    <textarea
      id="question_text"
      name="question_text"
      rows="3"
      required
    >{{ question.question_text }}</textarea>
  </div>

  <!-- Context / Notes -->
  <div class="form-group">
    <label for="contextual_info">Notes / Justification (optional)</label>
    <textarea
      id="contextual_info"
      name="contextual_info"
      rows="4"
    >{{ question.contextual_info }}</textarea>
  </div>

  <hr>

  <!-- Answers -->
  <h3>Answers</h3>

  <div id="answers-container">
    {% for a in answers %}
      <div class="answer-row">
        <input
          type="text"
          name="answers[]"
          value="{{ a.answer_text }}"
          required
        >

        <label>
          <input
            type="checkbox"
            name="correct_answers[]"
            value="{{ loop.index0 }}"
            {% if a.is_correct %}checked{% endif %}
          >
          Correct
        </label>

        <button
          type="button"
          class="delete-answer"
          onclick="removeAnswer(this)"
        >
          ğŸ—‘ï¸
        </button>
      </div>
    {% endfor %}
  </div>

  <button type="button" onclick="addAnswer()">â• Add Answer</button>

  <hr>

  <button type="submit">ğŸ’¾ Save Changes</button>
  <a href="javascript:history.back()">Cancel</a>

</form>

<!-- JavaScript -->
<script>
function addAnswer() {
  const container = document.getElementById("answers-container");
  const index = container.children.length;

  const div = document.createElement("div");
  div.className = "answer-row";

  div.innerHTML = `
    <input type="text" name="answers[]" required>
    <label>
      <input type="checkbox" name="correct_answers[]" value="${index}">
      Correct
    </label>
    <button type="button" onclick="removeAnswer(this)">ğŸ—‘ï¸</button>
  `;

  container.appendChild(div);
}

function removeAnswer(button) {
  const row = button.parentElement;
  row.remove();
  reindexCorrectAnswers();
}

function reindexCorrectAnswers() {
  const rows = document.querySelectorAll(".answer-row");
  rows.forEach((row, index) => {
    const checkbox = row.querySelector("input[type='checkbox']");
    checkbox.value = index;
  });
}
</script>

{% endblock %}
